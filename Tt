Parfait Youssef ğŸ™Œ â€” lÃ  câ€™est le point clÃ© quâ€™il nous manquait !
Sur ta capture, on voit que ton champ data.message contient des logs complets comme :

Job: [SimpleJob: [name=RestituerKofFoncAssociationsJob]] completed with the following parameters:
...
Nombre de rejets fonctionnels extraits sur 30 jours glissants : 3

Donc âœ… tu as bien un champ data.message au format texte brut (string), sans sous-champ .keyword.
â¡ï¸ On va donc lire directement depuis _source et extraire les nombres qui tâ€™intÃ©ressent (par ex. "Nombre de rejets fonctionnels extraitsâ€¦").


---

ğŸ¯ Exemple 1 : extraction du nombre de rejets

Tu veux sans doute isoler le 3 de la ligne :

Nombre de rejets fonctionnels extraits sur 30 jours glissants : 3

Voici le script exact Ã  mettre dans ton Runtime Field :

ğŸ§© Runtime Field : nombre_rejets_fonctionnels

Type : Long

Set value : ON

Script :


String msg = null;

// RÃ©cupÃ©ration sÃ»re depuis _source
if (params._source != null) {
  def src = params._source;
  if (src.containsKey('data') && src.data instanceof Map && src.data.containsKey('message')) {
    msg = src.data.message;
  } else if (src.containsKey('data.message')) {
    msg = src['data.message'];
  } else if (src.containsKey('message')) {
    msg = src.message;
  }
}

// Extraction : "Nombre de rejets fonctionnels extraits ... : <n>"
if (msg != null) {
  def m = /Nombre de rejets fonctionnels extraits[^:]*:\s*([0-9]+)/.matcher(msg);
  if (m.find()) {
    emit(Long.parseLong(m.group(1)));
  }
}

âœ… RÃ©sultat attendu :

Pour le message ci-dessus, ton champ nombre_rejets_fonctionnels affichera 3 dans Discover.



---

ğŸ§  Si tu veux extraire dâ€™autres infos numÃ©riques

Tu peux dupliquer le champ et simplement adapter la regex :

ğŸ”¹ Exemple pour â€œTotal time take in millis : 1111â€

def msg = params._source?.data?.message ?? params._source['data.message'];
if (msg != null) {
  def m = /Total time take in millis\s*:\s*([0-9]+)/.matcher(msg);
  if (m.find()) emit(Long.parseLong(m.group(1)));
}

ğŸ”¹ Exemple pour â€œPMs lues : 144678â€

def msg = params._source?.data?.message ?? params._source['data.message'];
if (msg != null) {
  def m = /PMs lues\s*:\s*([0-9]+)/.matcher(msg);
  if (m.find()) emit(Long.parseLong(m.group(1)));
}


---

âœ… Ã‰tapes aprÃ¨s crÃ©ation :

1. Clique sur Save dans le Runtime Field.


2. Retourne dans Discover, clique sur Refresh Fields.


3. Ajoute nombre_rejets_fonctionnels comme colonne â†’ tu devrais voir le nombre apparaÃ®tre sur les logs contenant la phrase correspondante.


4. Une fois validÃ© â†’ crÃ©e une visualisation â€œMetricâ€ â†’ Max(nombre_rejets_fonctionnels) pour ton dashboard.




---

Si tu veux, envoie-moi un exemple complet dâ€™un message typique data.message (copie texte, pas capture),
et je te fournis les 4 scripts (PMs lues, Associations lues, Documents lus, Rejets fonctionnels) tout prÃªts Ã  copier-coller.
Ã‡a tâ€™Ã©vitera dâ€™ajuster les regex Ã  la main.

