Excellent ğŸ‘Œ â€” câ€™est exactement le bon point Ã  clarifier.

â¡ï¸ Donc dans ton cas, le champ data.message contient un texte brut du style :

PMs lues : 144678 | PMs non concernÃ©es : 144574 | PMs concernÃ©es : 304 | PMs en anomalies : 0

et tu veux extraire la valeur numÃ©rique â€œ144678â€ (ou dâ€™autres nombres selon la mÃ©trique) pour lâ€™afficher automatiquement dans ton dashboard Kibana.

Parfaitement faisable ğŸ’ª
Voici comment procÃ©der pas Ã  pas â¬‡ï¸


---

ğŸ§  Objectif

CrÃ©er des champs calculÃ©s (Runtime fields) dans Kibana pour isoler ces valeurs :

PMs_lues

PMs_concernees

PMs_non_concernees

PMs_anomalies


Tu pourras ensuite les utiliser comme de vrais champs numÃ©riques dans les visualisations (mÃ©triques, courbes, etc.).


---

âš™ï¸ Ã‰tape 1 â€” Ouvrir la gestion du schÃ©ma

1. Va dans Stack Management â†’ Data Views (ou Index Patterns)


2. SÃ©lectionne ton data view (ex. AP11382 ou celui que tu utilises dans Discover)


3. Clique sur Add field




---

ğŸ§© Ã‰tape 2 â€” CrÃ©er le champ â€œPMs luesâ€

1. Nom : pms_lues


2. Type : Number


3. Script (langage Painless) :

if (doc['data.message.keyword'].size() > 0) {
  def msg = doc['data.message.keyword'].value;
  def m = /PMs lues\s*:\s*(\d+)/.matcher(msg);
  if (m.find()) return Integer.parseInt(m.group(1));
}
return null;


4. Clique sur Save field




---

ğŸ§© Ã‰tape 3 â€” RÃ©pÃ©ter pour les autres valeurs

â–¶ï¸ PMs concernÃ©es :

if (doc['data.message.keyword'].size() > 0) {
  def msg = doc['data.message.keyword'].value;
  def m = /PMs concernÃ©es\s*:\s*(\d+)/.matcher(msg);
  if (m.find()) return Integer.parseInt(m.group(1));
}
return null;

â–¶ï¸ PMs non concernÃ©es :

if (doc['data.message.keyword'].size() > 0) {
  def msg = doc['data.message.keyword'].value;
  def m = /PMs non concernÃ©es\s*:\s*(\d+)/.matcher(msg);
  if (m.find()) return Integer.parseInt(m.group(1));
}
return null;

â–¶ï¸ PMs en anomalies :

if (doc['data.message.keyword'].size() > 0) {
  def msg = doc['data.message.keyword'].value;
  def m = /PMs en anomalies\s*:\s*(\d+)/.matcher(msg);
  if (m.find()) return Integer.parseInt(m.group(1));
}
return null;


---

ğŸ§® Ã‰tape 4 â€” VÃ©rification dans Discover

1. Retourne dans Discover


2. RafraÃ®chis ton data view (en haut Ã  droite â†’ â€œRefresh fieldsâ€)


3. Ajoute les nouvelles colonnes :
pms_lues, pms_concernees, etc.


4. Tu devrais maintenant voir les valeurs numÃ©riques extraites Ã  partir du texte.




---

ğŸ“Š Ã‰tape 5 â€” CrÃ©er une visualisation simple

1. Va dans Visualize â†’ Create visualization â†’ Metric


2. Metric â†’ Aggregation = Max(pms_lues) ou Last value(pms_lues)
(selon la version de Kibana)


3. Filtre optionnel :

data.message:"PMs lues"


4. Sauvegarde et ajoute au Dashboard.




---

ğŸ¯ RÃ©sultat

Tu obtiens automatiquement :

â€œPMs lues : 144 678â€

â€œPMs concernÃ©es : 304â€

â€œPMs anomalies : 0â€


et Ã§a se mettra Ã  jour Ã  chaque exÃ©cution du job ou Ã  chaque log reÃ§u.


---

Souhaites-tu que je te crÃ©e le script complet avec les 4 champs prÃªts Ã  copier-coller (au format JSON Kibana pour ajout direct dans lâ€™Index Pattern) ?
ğŸ‘‰ Comme Ã§a tu pourras tout importer dâ€™un coup sans le faire Ã  la main.

